
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Todo App v1.0</title>
    
    <!-- iPhone„Éõ„Éº„É†ÁîªÈù¢Áî®„ÅÆË®≠ÂÆö -->
    <link rel="apple-touch-icon" href="icon-180.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Simple Todo App">
    
    <!-- Android/„Åù„ÅÆ‰ªñÁî® -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="manifest" href="manifest.json">
    
    <!-- „Ç´„Çπ„Çø„É†„Çπ„Çø„Ç§„É´ -->
    <link rel="stylesheet" href="src/custom/styles.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <!-- „Ç´„Çπ„Çø„É†Ë®≠ÂÆö -->
    <script type="module" src="src/custom/app-config.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 2px; background: #f5f5f5; font-size: 14px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 5px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        /* „Éë„Éç„É´Ë°®Á§∫„É¢„Éº„ÉâÂàá„ÇäÊõø„Åà */
        body.panel-mode .section-panel {
            position: relative;
            border: 2px solid #007bff;
            border-radius: 6px;
            padding: 8px;
            margin: 6px 0;
            background: white;
            box-shadow: 0 2px 5px rgba(0,123,255,0.2);
        }
        body.panel-mode .panel-number {
            display: block;
            position: absolute;
            top: -8px;
            left: 8px;
            background: #007bff;
            color: white;
            padding: 1px 6px;
            font-weight: bold;
            font-size: 11px;
            border-radius: 3px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
            z-index: 10;
        }
        
        /* ÈÄöÂ∏∏„É¢„Éº„Éâ */
        body:not(.panel-mode) .section-panel {
            position: relative;
            padding: 5px;
            margin: 5px 0;
        }
        body:not(.panel-mode) .panel-number {
            display: none;
        }
        
        /* ÈöéÂ±§„Çµ„Ç§„Ç∫ */
        .panel-L { /* Â§ß */ }
        .panel-M { /* ‰∏≠ */
            padding: 6px !important;
            border-width: 1px !important;
            margin: 2px 0 !important;
        }
        .panel-S { /* Â∞è */
            padding: 4px !important;
            border-width: 1px !important;
            margin: 1px 0 !important;
        }
        
        /* „É¢„Éº„ÉâÂàá„ÇäÊõø„Åà„Éú„Çø„É≥ */
        .mode-toggle {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .mode-toggle:hover {
            background: #0056b3;
        }
        .grid-toggle {
            position: fixed;
            top: 50px;
            right: 10px;
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 10000001;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .grid-toggle:hover {
            background: #218838;
        }
        
        /* „Ç∞„É™„ÉÉ„ÉâË°®Á§∫„É¢„Éº„ÉâÔºà„Ç∑„É≥„Éó„É´ÁâàÔºâ */
        body.grid-mode::before {
            content: "üìê „Ç∞„É™„ÉÉ„ÉâË°®Á§∫„É¢„Éº„Éâ";
            position: fixed;
            top: 50px;
            right: 10px;
            background: rgba(255,255,255,0.95);
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            z-index: 1000001;
        }
        
        /* „Çπ„Éû„ÉõÂØæÂøú */
        @media (max-width: 768px) {
            body { padding: 1px; }
            .container { padding: 3px; margin: 0; border-radius: 0; }
            .weight-input { grid-template-columns: 1fr; gap: 4px; }
            .input-card { padding: 4px; }
        }
        .auth-section { background: #e7f3ff; color: #0c5460; padding: 5px; border-radius: 4px; text-align: center; }
        .weight-input { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 5px; margin: 4px 0; }
        .input-card { border: 1px solid #ddd; padding: 6px; border-radius: 6px; }
        
        /* „Çø„Ç§„Éü„É≥„Ç∞„Éë„Éç„É´„ÅÆ„Çπ„Çø„Ç§„É´ */
        .timing-panel { 
            background: #f8f9fa; 
            border: 1px solid #e9ecef; 
            border-radius: 4px; 
            padding: 4px; 
            margin: 3px 0; 
        }
        .timing-buttons { 
            display: flex; 
            gap: 2px; 
            flex-wrap: wrap; 
            justify-content: center;
        }
        .timing-btn, .tool-btn { 
            background: #6c757d; 
            color: white; 
            border: none; 
            padding: 4px 6px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 10px;
            transition: all 0.2s;
            min-width: 50px;
            text-align: center;
            margin: 1px;
        }
        .timing-btn:hover, .tool-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }
        .timing-btn.selected, .tool-btn.active {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.8);
            border: 2px solid #fff;
        }
        .brush-tools {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 10px 0;
        }
        #paintCanvas {
            box-shadow: 0 0 30px rgba(255, 0, 128, 0.3);
        }
        
        @media (max-width: 768px) {
            .timing-buttons { gap: 3px; }
            .timing-btn { 
                padding: 4px 6px; 
                font-size: 10px;
                min-width: 60px;
            }
        }
        .input-field { width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; margin: 3px 0; font-size: 14px; }
        .save-button { background: #28a745; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin: 3px; font-size: 13px; }
        .save-button:hover { background: #218838; }
        
        /* TodoÁî®„Çπ„Çø„Ç§„É´ */
        .filter-btn { background: #6c757d; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; margin: 2px; font-size: 12px; }
        .filter-btn.active { background: #007bff; }
        .filter-btn:hover { background: #0056b3; }
        
        .todo-item { 
            background: white; 
            border: 1px solid #ddd; 
            border-radius: 6px; 
            padding: 6px; 
            margin: 4px 0; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            transition: all 0.2s;
        }
        .todo-item:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        
        .todo-item.completed { 
            background: #f8f9fa; 
            opacity: 0.7; 
        }
        .todo-item.completed .todo-text { 
            text-decoration: line-through; 
            color: #6c757d; 
        }
        
        .todo-content { 
            display: flex; 
            align-items: center; 
            flex: 1; 
            gap: 6px; 
        }
        
        .todo-checkbox { 
            width: 16px; 
            height: 16px; 
            cursor: pointer; 
        }
        
        .todo-text { 
            flex: 1; 
            font-size: 14px; 
        }
        
        .todo-priority { 
            padding: 2px 6px; 
            border-radius: 8px; 
            font-size: 10px; 
            font-weight: bold; 
        }
        .todo-priority.high { background: #ffe6e6; color: #dc3545; }
        .todo-priority.medium { background: #fff3cd; color: #856404; }
        .todo-priority.low { background: #e6f7e6; color: #28a745; }
        
        .todo-actions { 
            display: flex; 
            gap: 3px; 
        }
        
        .todo-btn { 
            background: #dc3545; 
            color: white; 
            border: none; 
            padding: 3px 6px; 
            border-radius: 3px; 
            cursor: pointer; 
            font-size: 11px; 
        }
        .todo-btn:hover { background: #c82333; }
        .auth-button { background: #4285f4; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin: 3px; font-size: 13px; }
        .auth-button:hover { background: #357ae8; }
        .logout-button { background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; margin: 3px; font-size: 11px; }
        .data-area { background: #f8f9fa; border: 1px solid #dee2e6; padding: 6px; border-radius: 4px; font-family: monospace; min-height: 80px; font-size: 12px; }
        .hidden { display: none; }
        .user-info { background: #d4edda; color: #155724; padding: 6px; border-radius: 5px; margin-bottom: 8px; }
    </style>
</head>
<body class="panel-mode">
    <!-- ‚ö†Ô∏è ÈñãÁô∫Ë£úÂä©Ê©üËÉΩÔºàÂâäÈô§Á¶ÅÊ≠¢Ôºâ -->
    <button class="mode-toggle" onclick="togglePanelMode()">üìä „Éë„Éç„É´Ë°®Á§∫</button>
    <button class="grid-toggle" onclick="toggleGridMode()">‚äû „Ç∞„É™„ÉÉ„ÉâË°®Á§∫</button>
    <!-- ÈñãÁô∫Ë£úÂä©Ê©üËÉΩ„Åì„Åì„Åæ„Åß -->
    
    <div class="container">
        <!-- ‚ö†Ô∏è „Éë„Éç„É´1: Ë™çË®ºÔºàÂâäÈô§Á¶ÅÊ≠¢Ôºâ -->
        <div class="section-panel panel-L">
            <span class="panel-number">[1-L]</span>
            <div class="app-header" style="margin: 0 !important; padding: 0 !important; margin-bottom: 0px !important;">
                <h1 class="app-title" style="margin: 0 !important; padding: 0 !important; font-size: 20px; line-height: 1.0 !important; height: auto !important; min-height: auto !important;">üìù Simple Todo App</h1>
            </div>
            <!-- Ë™çË®º„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="auth-section" id="authSection" style="padding: 6px; text-align: center;">
                <button class="auth-button" onclick="handleGoogleLogin()">Google„Åß„É≠„Ç∞„Ç§„É≥</button>
                <p style="margin: 5px 0; font-size: 12px; color: #666;">„É≠„Ç∞„Ç§„É≥„Åô„Çã„Å®„Éá„Éº„Çø„ÅåÂêåÊúü„Åï„Çå„Åæ„Åô</p>
            </div>
            <!-- „É¶„Éº„Ç∂„ÉºÊÉÖÂ†±Ë°®Á§∫ („É≠„Ç∞„Ç§„É≥Âæå„Å´Ë°®Á§∫) -->
            <div class="user-info hidden" id="userInfo" style="padding: 6px; text-align: center; background: #d4edda; border-radius: 5px;">
                <span style="font-size: 14px;">üë§ <span id="userName"></span></span>
                <button class="logout-button" onclick="handleLogout()" style="margin-left: 10px; padding: 4px 8px; font-size: 12px;">„É≠„Ç∞„Ç¢„Ç¶„Éà</button>
            </div>
        </div>
        
        <!-- „Éë„Éç„É´2: Todo„Ç¢„Éó„É™Ôºà„É°„Ç§„É≥Ê©üËÉΩÔºâ -->
        <div class="section-panel panel-L hidden" id="userPanel">
            <span class="panel-number">[2-L]</span>

            <!-- „Ç´„ÉÜ„Ç¥„É™„Éû„Çπ„ÇøËøΩÂä†„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="category-master-section section-panel panel-M">
                <span class="panel-number">[2.0-M]</span>
                <div class="input-card">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <h3 style="margin: 0; white-space: nowrap;">üè∑Ô∏è „Ç´„ÉÜ„Ç¥„É™ËøΩÂä†</h3>
                        <input type="text" id="categoryInput" placeholder="„Ç´„ÉÜ„Ç¥„É™Âêç„ÇíÂÖ•Âäõ..." class="input-field" onkeypress="handleCategoryKeypress(event)" style="flex: 1;">
                        <button onclick="addCategory()" class="save-button">‚ûï ËøΩÂä†</button>
                    </div>
                    <div id="categoryList" style="display: flex; gap: 5px; flex-wrap: wrap;">
                        <!-- „Ç´„ÉÜ„Ç¥„É™„Çø„Ç∞„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                    </div>
                </div>
            </div>

            <!-- TodoÂÖ•Âäõ„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="todo-input-section section-panel panel-M">
                <span class="panel-number">[2.1-M]</span>
                <div class="input-card">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <h3 style="margin: 0; white-space: nowrap;">üìù Êñ∞„Åó„ÅÑ„Çø„Çπ„ÇØ„ÇíËøΩÂä†</h3>
                        <input type="text" id="todoInput" placeholder="„Çø„Çπ„ÇØ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ..." class="input-field" onkeypress="handleTodoKeypress(event)" style="flex: 1;">
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <select id="todoCategory" class="input-field" style="width: auto;">
                            <option value="">üìÇ „Ç´„ÉÜ„Ç¥„É™„Å™„Åó</option>
                            <!-- „Ç´„ÉÜ„Ç¥„É™„Ç™„Éó„Ç∑„Éß„É≥„ÅåÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Çã -->
                        </select>
                        <select id="todoPriority" class="input-field" style="width: auto;">
                            <option value="low">üü¢ ‰Ωé</option>
                            <option value="medium" selected>üü° ‰∏≠</option>
                            <option value="high">üî¥ È´ò</option>
                        </select>
                        <button onclick="addTodo()" class="save-button">‚ûï „Çø„Çπ„ÇØËøΩÂä†</button>
                    </div>
                </div>
            </div>

            <!-- Todo„É™„Çπ„ÉàË°®Á§∫ -->
            <div class="todo-list-section section-panel panel-M">
                <span class="panel-number">[2.2-M]</span>
                <h3 style="margin-top: 0; margin-bottom: 8px;">üìã „Çø„Çπ„ÇØ‰∏ÄË¶ß</h3>
                
                <!-- „Éï„Ç£„É´„Çø„Éº„Éú„Çø„É≥ -->
                <div style="margin-bottom: 10px;">
                    <button onclick="filterTodos('all')" class="filter-btn active" data-filter="all">ÂÖ®„Å¶</button>
                    <button onclick="filterTodos('pending')" class="filter-btn" data-filter="pending">Êú™ÂÆå‰∫Ü</button>
                    <button onclick="filterTodos('completed')" class="filter-btn" data-filter="completed">ÂÆå‰∫ÜÊ∏à„Åø</button>
                </div>
                
                <!-- Todo„É™„Çπ„Éà -->
                <div id="todoList" class="todo-list">
                    <p style="text-align: center; color: #666;">„Åæ„Å†„Çø„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                </div>
            </div>
        </div>

        <!-- ‚ö†Ô∏è „Éë„Éç„É´3: „É≠„Ç∞ÔºàÂâäÈô§Á¶ÅÊ≠¢Ôºâ -->
        <div class="section-panel panel-L">
            <span class="panel-number">[3-L]</span>
            <h3>üìã „Ç¢„Éó„É™„É≠„Ç∞ <button class="universal-copy-btn" onclick="copyLogs()" style="background: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 12px;">üìã „É≠„Ç∞„Çí„Ç≥„Éî„Éº</button></h3>
            <div class="data-area" id="logArea">
            Simple Todo App v1.0 Ëµ∑ÂãïÂÆå‰∫Ü...<br>
            üî• FirebaseË®≠ÂÆöÂÆå‰∫Ü<br>
            üîê GoogleË™çË®ºÊ∫ñÂÇôÂÆå‰∫Ü<br>
            </div>
        </div>
        
        <!-- ‚ö†Ô∏è „Éë„Éç„É´4: „Éá„Éê„ÉÉ„Ç∞„Éú„Çø„É≥ÔºàÂâäÈô§Á¶ÅÊ≠¢Ôºâ -->
        <div class="section-panel panel-L" style="margin-top: 8px; text-align: center;">
            <span class="panel-number">[4-L]</span>
            <button class="universal-copy-btn" onclick="debugFirebaseConnection()" style="background: #ff6b6b; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">üîç Firebase Debug</button>
            <button onclick="testGridAdjust()" style="background: #17a2b8; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">üìê GridË™øÊï¥„ÉÜ„Çπ„Éà</button>
            <button class="universal-copy-btn" onclick="checkLoginIssues()" style="background: #ffc107; color: #212529; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">‚ö†Ô∏è „É≠„Ç∞„Ç§„É≥ÂïèÈ°åË®∫Êñ≠</button>
            <button class="universal-copy-btn" onclick="copyDebugInfo()" style="background: #17a2b8; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">üìã „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„Çí„Ç≥„Éî„Éº</button>
            <button class="universal-copy-btn" onclick="checkDatabaseStructure()" style="background: #6f42c1; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">üèóÔ∏è DBÊßãÈÄ†Á¢∫Ë™ç</button>
            <button class="universal-copy-btn" onclick="checkMobileSupport()" style="background: #28a745; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">üì± „É¢„Éê„Ç§„É´Ë®∫Êñ≠</button>
            <button class="universal-copy-btn" onclick="forceAuthCheck()" style="background: #fd7e14; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">üîÑ Ë™çË®ºÁä∂ÊÖãÁ¢∫Ë™ç</button>
            <button class="universal-copy-btn" onclick="checkFirebaseConfig()" style="background: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">üîß FirebaseË®≠ÂÆö</button>
            <button class="universal-copy-btn" onclick="testPopup()" style="background: #20c997; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">üß™ „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÉÜ„Çπ„Éà</button>
            <button class="universal-copy-btn" onclick="window.open('test-error.html', '_blank')" style="background: #e74c3c; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">üö® „Ç®„É©„Éº„ÉÜ„Çπ„Éà</button>
        </div>
        
    </div>

    <script>
        // Core FirebaseË®≠ÂÆöÔºàÂ§âÊõ¥Á¶ÅÊ≠¢ - core/src/firebase-config.jsÂèÇÁÖßÔºâ
        const firebaseConfig = {
            apiKey: "AIzaSyA5PXKChizYDCXF_GJ4KL6Ylq9K5hCPXWE",
            authDomain: "shares-b1b97.firebaseapp.com",
            databaseURL: "https://shares-b1b97-default-rtdb.firebaseio.com",
            projectId: "shares-b1b97",
            storageBucket: "shares-b1b97.firebasestorage.app",
            messagingSenderId: "38311063248",
            appId: "1:38311063248:web:0d2d5726d12b305b24b8d5"
        };

        // FirebaseÂàùÊúüÂåñ
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        let currentUser = null;
        let todos = [];
        let categories = [];
        let currentFilter = 'all';

        // TodoÈñ¢ÈÄ£„ÅÆÊ©üËÉΩ
        window.handleTodoKeypress = (event) => {
            if (event.key === 'Enter') {
                addTodo();
            }
        };

        // TodoËøΩÂä†
        window.addTodo = () => {
            const input = document.getElementById('todoInput');
            const category = document.getElementById('todoCategory');
            const priority = document.getElementById('todoPriority');
            const text = input.value.trim();
            
            if (!text) {
                log('‚ùå „Çø„Çπ„ÇØ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            const todo = {
                id: Date.now().toString(),
                text: text,
                category: category.value,
                priority: priority.value,
                completed: false,
                createdAt: new Date().toISOString(),
                userEmail: currentUser ? currentUser.email : 'guest'
            };

            // Firebase„Å´‰øùÂ≠ò
            if (currentUser) {
                saveTodoToFirebase(todo);
            } else {
                // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å´‰øùÂ≠ò
                todos.push(todo);
                localStorage.setItem('todos', JSON.stringify(todos));
                renderTodos();
            }

            input.value = '';
            priority.value = 'medium';
            log(`‚úÖ „Çø„Çπ„ÇØËøΩÂä†: ${text}`);
        };

        // TodoÂÆå‰∫ÜÂàá„ÇäÊõø„Åà
        window.toggleTodo = (id) => {
            if (currentUser) {
                const todoRef = database.ref(`users/${currentUser.uid}/todos/${id}`);
                todoRef.once('value', (snapshot) => {
                    const todo = snapshot.val();
                    if (todo) {
                        todoRef.update({ completed: !todo.completed });
                    }
                });
            } else {
                todos = todos.map(todo => 
                    todo.id === id ? { ...todo, completed: !todo.completed } : todo
                );
                localStorage.setItem('todos', JSON.stringify(todos));
                renderTodos();
            }
        };

        // TodoÂâäÈô§
        window.deleteTodo = (id) => {
            if (!confirm('„Åì„ÅÆ„Çø„Çπ„ÇØ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;

            if (currentUser) {
                const todoRef = database.ref(`users/${currentUser.uid}/todos/${id}`);
                todoRef.remove();
            } else {
                todos = todos.filter(todo => todo.id !== id);
                localStorage.setItem('todos', JSON.stringify(todos));
                renderTodos();
            }
            log('üóëÔ∏è „Çø„Çπ„ÇØ„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
        };

        // „Éï„Ç£„É´„Çø„ÉºÂàá„ÇäÊõø„Åà
        window.filterTodos = (filter) => {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
            renderTodos();
        };

        // „Ç´„ÉÜ„Ç¥„É™Èñ¢ÈÄ£„ÅÆÊ©üËÉΩ
        window.handleCategoryKeypress = (event) => {
            if (event.key === 'Enter') {
                addCategory();
            }
        };

        // „Ç´„ÉÜ„Ç¥„É™ËøΩÂä†
        window.addCategory = () => {
            const input = document.getElementById('categoryInput');
            const categoryName = input.value.trim();
            
            if (!categoryName) {
                log('‚ùå „Ç´„ÉÜ„Ç¥„É™Âêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            if (categories.find(cat => cat.name === categoryName)) {
                log('‚ùå Âêå„Åò„Ç´„ÉÜ„Ç¥„É™Âêç„ÅåÊó¢„Å´Â≠òÂú®„Åó„Åæ„Åô');
                return;
            }

            const category = {
                id: Date.now().toString(),
                name: categoryName,
                createdAt: new Date().toISOString(),
                userEmail: currentUser ? currentUser.email : 'guest'
            };

            // Firebase„Å´‰øùÂ≠ò
            if (currentUser) {
                saveCategoryToFirebase(category);
            } else {
                // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å´‰øùÂ≠ò
                categories.push(category);
                localStorage.setItem('categories', JSON.stringify(categories));
                renderCategories();
                updateCategoryDropdown();
            }

            input.value = '';
            log(`‚úÖ „Ç´„ÉÜ„Ç¥„É™ËøΩÂä†: ${categoryName}`);
        };

        // „Ç´„ÉÜ„Ç¥„É™ÂâäÈô§
        window.deleteCategory = (id) => {
            if (!confirm('„Åì„ÅÆ„Ç´„ÉÜ„Ç¥„É™„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;

            if (currentUser) {
                const categoryRef = database.ref(`users/${currentUser.uid}/categories/${id}`);
                categoryRef.remove();
            } else {
                categories = categories.filter(cat => cat.id !== id);
                localStorage.setItem('categories', JSON.stringify(categories));
                renderCategories();
                updateCategoryDropdown();
            }
            log('üóëÔ∏è „Ç´„ÉÜ„Ç¥„É™„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
        };

        // „Ç´„ÉÜ„Ç¥„É™Ë°®Á§∫
        function renderCategories() {
            const categoryList = document.getElementById('categoryList');
            
            if (categories.length === 0) {
                categoryList.innerHTML = '<span style="color: #666; font-size: 12px;">„Ç´„ÉÜ„Ç¥„É™„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</span>';
                return;
            }

            categoryList.innerHTML = categories.map(category => `
                <span style="background: #e3f2fd; color: #1976d2; padding: 4px 8px; border-radius: 12px; font-size: 12px; display: flex; align-items: center; gap: 4px;">
                    üè∑Ô∏è ${category.name}
                    <button onclick="deleteCategory('${category.id}')" style="background: none; border: none; color: #d32f2f; cursor: pointer; padding: 0; font-size: 14px;" title="ÂâäÈô§">√ó</button>
                </span>
            `).join('');
        }

        // „Ç´„ÉÜ„Ç¥„É™„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥Êõ¥Êñ∞
        function updateCategoryDropdown() {
            const dropdown = document.getElementById('todoCategory');
            
            // Êó¢Â≠ò„ÅÆ„Ç™„Éó„Ç∑„Éß„É≥„Çí‰øùÊåÅ„Åó„Å¶Êñ∞„Åó„ÅÑ„Ç´„ÉÜ„Ç¥„É™„ÇíËøΩÂä†
            dropdown.innerHTML = '<option value="">üìÇ „Ç´„ÉÜ„Ç¥„É™„Å™„Åó</option>';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.name;
                option.textContent = `üè∑Ô∏è ${category.name}`;
                dropdown.appendChild(option);
            });
        }

        // TodoË°®Á§∫
        function renderTodos() {
            const todoList = document.getElementById('todoList');
            let displayTodos = todos;

            // „Éï„Ç£„É´„Çø„ÉºÈÅ©Áî®
            if (currentFilter === 'completed') {
                displayTodos = todos.filter(todo => todo.completed);
            } else if (currentFilter === 'pending') {
                displayTodos = todos.filter(todo => !todo.completed);
            }

            if (displayTodos.length === 0) {
                todoList.innerHTML = '<p style="text-align: center; color: #666;">„Çø„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                return;
            }

            // ÂÑ™ÂÖàÂ∫¶È†Ü„Åß„ÇΩ„Éº„Éà
            const priorityOrder = { high: 3, medium: 2, low: 1 };
            displayTodos.sort((a, b) => {
                if (a.completed !== b.completed) return a.completed - b.completed;
                return priorityOrder[b.priority] - priorityOrder[a.priority];
            });

            todoList.innerHTML = displayTodos.map(todo => `
                <div class="todo-item ${todo.completed ? 'completed' : ''}">
                    <div class="todo-content">
                        <input type="checkbox" class="todo-checkbox" 
                               ${todo.completed ? 'checked' : ''} 
                               onchange="toggleTodo('${todo.id}')">
                        <span class="todo-text">${todo.text}</span>
                        <span class="todo-priority ${todo.priority}">
                            ${todo.priority === 'high' ? 'üî¥' : todo.priority === 'medium' ? 'üü°' : 'üü¢'} 
                            ${todo.priority === 'high' ? 'È´ò' : todo.priority === 'medium' ? '‰∏≠' : '‰Ωé'}
                        </span>
                    </div>
                    <div class="todo-actions">
                        <button class="todo-btn" onclick="deleteTodo('${todo.id}')">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        // Firebase Todo‰øùÂ≠ò
        function saveTodoToFirebase(todo) {
            if (!currentUser) return;
            
            const todoRef = database.ref(`users/${currentUser.uid}/todos/${todo.id}`);
            todoRef.set(todo).then(() => {
                log(`üíæ Firebase„Å´‰øùÂ≠ò: ${todo.text}`);
            }).catch(error => {
                log(`‚ùå ‰øùÂ≠ò„Ç®„É©„Éº: ${error.message}`);
            });
        }

        // Firebase „Ç´„ÉÜ„Ç¥„É™‰øùÂ≠ò
        function saveCategoryToFirebase(category) {
            if (!currentUser) return;
            
            const categoryRef = database.ref(`users/${currentUser.uid}/categories/${category.id}`);
            categoryRef.set(category).then(() => {
                log(`üíæ „Ç´„ÉÜ„Ç¥„É™„ÇíFirebase„Å´‰øùÂ≠ò: ${category.name}`);
            }).catch(error => {
                log(`‚ùå „Ç´„ÉÜ„Ç¥„É™‰øùÂ≠ò„Ç®„É©„Éº: ${error.message}`);
            });
        }

        // Ë™çË®ºÁä∂ÊÖã„ÅÆÁõ£Ë¶ñÔºàÊîπËâØÁâàÔºâ
        auth.onAuthStateChanged((user) => {
            currentUser = user;
            if (user) {
                log(`‚úÖ Ë™çË®ºÁä∂ÊÖãÁ¢∫Ë™ç: ${user.displayName} „Åß„É≠„Ç∞„Ç§„É≥‰∏≠`);
                log(`üìß „É°„Éº„É´: ${user.email}`);
                showUserInterface(user);
                loadUserTodos(user.uid);
                loadUserCategories(user.uid);
            } else {
                log('üîí Ë™çË®ºÁä∂ÊÖã: Êú™„É≠„Ç∞„Ç§„É≥');
                showLoginInterface();
                loadLocalTodos();
                loadLocalCategories();
            }
        });

        // ÂàùÊúüÂåñÂÆå‰∫Ü„É≠„Ç∞
        log('üîÑ FirebaseË™çË®º„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñÂÆå‰∫Ü - Ë™çË®ºÁä∂ÊÖã„ÇíÁ¢∫Ë™ç‰∏≠...');

        // Google„É≠„Ç∞„Ç§„É≥ÔºàÊîπËâØÁâà - „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Éñ„É≠„ÉÉ„ÇØÊ§úÁü•‰ªò„ÅçÔºâ
        window.handleGoogleLogin = async () => {
            try {
                log('üîê Google„É≠„Ç∞„Ç§„É≥ÈñãÂßã...');
                const provider = new firebase.auth.GoogleAuthProvider();
                
                // „É¢„Éê„Ç§„É´„Éá„Éê„Ç§„ÇπÊ§úÂá∫ÔºàË°®Á§∫Áî®Ôºâ
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                
                if (isMobile) {
                    log('üì± „É¢„Éê„Ç§„É´„Éá„Éê„Ç§„ÇπÊ§úÂá∫ - „Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóÊñπÂºè„Åß„É≠„Ç∞„Ç§„É≥');
                    log('üí° „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÅåÈÄî‰∏≠„ÅßÊ≠¢„Åæ„ÇãÂ†¥Âêà„ÅØ„ÄÅ„Éñ„É©„Ç¶„Ç∂Ë®≠ÂÆö„ÅÆÁ¢∫Ë™ç„ÅåÂøÖË¶Å„Åß„Åô');
                } else {
                    log('üñ•Ô∏è „Éá„Çπ„ÇØ„Éà„ÉÉ„Éó„Éá„Éê„Ç§„Çπ - „Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóÊñπÂºè„Åß„É≠„Ç∞„Ç§„É≥');
                }
                
                // „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Éñ„É≠„ÉÉ„ÇØÊ§úÁü•„ÅÆ„Åü„ÇÅ„ÅÆ„Çø„Ç§„É†„Ç¢„Ç¶„ÉàË®≠ÂÆö
                log('ü™ü „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Ç¶„Ç£„É≥„Éâ„Ç¶„ÅßGoogle„É≠„Ç∞„Ç§„É≥„ÇíÈñãÂßã...');
                
                const loginPromise = auth.signInWithPopup(provider);
                
                // „Çø„Ç§„É†„Ç¢„Ç¶„ÉàÊ§úÁü•Ôºà5Áßí„Åß„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÅåÈñã„Åã„Å™„ÅÑÂ†¥ÂêàÔºâ
                const timeoutPromise = new Promise((_, reject) => {
                    setTimeout(() => {
                        reject(new Error('„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Çø„Ç§„É†„Ç¢„Ç¶„Éà - „Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„ÅüÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô'));
                    }, 5000);
                });
                
                try {
                    const result = await Promise.race([loginPromise, timeoutPromise]);
                    log(`‚úÖ „É≠„Ç∞„Ç§„É≥ÊàêÂäü: ${result.user.displayName}`);
                } catch (raceError) {
                    // „Çø„Ç§„É†„Ç¢„Ç¶„Éà„ÅÆÂ†¥Âêà„ÅÆÁâπÂà•Âá¶ÁêÜ
                    if (raceError.message.includes('„Çø„Ç§„É†„Ç¢„Ç¶„Éà')) {
                        log('‚è∞ „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Åå5Áßí‰ª•ÂÜÖ„Å´Èñã„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü');
                        log('üîÑ „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Éñ„É≠„ÉÉ„ÇØÊ§úÁü• - Ëß£Ê±∫ÊñπÊ≥ï„Çí„ÅîÊ°àÂÜÖ„Åó„Åæ„Åô');
                        throw new Error('POPUP_TIMEOUT');
                    } else {
                        throw raceError;
                    }
                }
                
            } catch (error) {
                log(`‚ùå „É≠„Ç∞„Ç§„É≥„Ç®„É©„Éº: ${error.message}`);
                
                // „Ç®„É©„Éº„ÅÆË©≥Á¥∞ÊÉÖÂ†±„Çí„É≠„Ç∞„Å´Âá∫Âäõ
                if (error.code) {
                    log(`- „Ç®„É©„Éº„Ç≥„Éº„Éâ: ${error.code}`);
                    
                    // ÁâπÂÆö„ÅÆ„Ç®„É©„Éº„Ç≥„Éº„Éâ„Å´ÂØæ„Åô„ÇãËß£Ê±∫Á≠ñ„ÇíÊèêÁ§∫
                    switch(error.code) {
                        case 'auth/unauthorized-domain':
                            log('üí° „Éâ„É°„Ç§„É≥Ë®±ÂèØË®≠ÂÆö„ÅÆÂïèÈ°å„Åß„Åô');
                            log('üí° Firebase Console„ÅßË™çË®º„Éâ„É°„Ç§„É≥„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                            break;
                        case 'auth/popup-blocked':
                            log('üí° „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Åå„Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü');
                            showPopupGuide(isMobile);
                            break;
                        case 'auth/popup-closed-by-user':
                            log('üí° „É¶„Éº„Ç∂„Éº„Åå„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÇíÈñâ„Åò„Åæ„Åó„Åü');
                            log('üí° „ÇÇ„ÅÜ‰∏ÄÂ∫¶„É≠„Ç∞„Ç§„É≥„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                            break;
                        case 'auth/cancelled-popup-request':
                            log('üí° ÂâçÂõû„ÅÆ„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Åå„Ç≠„É£„É≥„Çª„É´„Åï„Çå„Åæ„Åó„Åü');
                            log('üí° „Åó„Å∞„Çâ„ÅèÂæÖ„Å£„Å¶„Åã„ÇâÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                            break;
                        default:
                            if (error.message === 'POPUP_TIMEOUT') {
                                log('‚ö†Ô∏è „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÅåÈÄî‰∏≠„ÅßÊ≠¢„Åæ„Çä„Åæ„Åó„Åü');
                                showPopupGuide(isMobile);
                            } else {
                                log('üí° „Éñ„É©„Ç¶„Ç∂„ÇíÊõ¥Êñ∞„Åó„Å¶„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ');
                            }
                    }
                } else if (error.message === 'POPUP_TIMEOUT') {
                    showPopupGuide(isMobile);
                }
                
                if (error.credential) {
                    log('- Ë™çË®ºÊÉÖÂ†±„ÅØÂèñÂæóÊ∏à„Åø');
                }
            }
        };

        // „Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóË®±ÂèØ„Ç¨„Ç§„ÉâË°®Á§∫
        function showPopupGuide(isMobile) {
            log('üìñ === „Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóË®±ÂèØ„Ç¨„Ç§„Éâ ===');
            if (isMobile) {
                log('üì± „Çπ„Éû„Éº„Éà„Éï„Ç©„É≥Âêë„ÅëËß£Ê±∫ÊâãÈ†Ü:');
                log('1. „Éö„Éº„Ç∏‰∏äÈÉ®„ÅÆ„Ç¢„Éâ„É¨„Çπ„Éê„Éº„Å´Ë°®Á§∫„Åï„Çå„Çã„Äå„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Åå„Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü„Äç„Çí„Çø„ÉÉ„Éó');
                log('2. „Åæ„Åü„ÅØ„ÄÅ„Éñ„É©„Ç¶„Ç∂„É°„Éã„É•„Éº(‚ãÆ) ‚Üí Ë®≠ÂÆö ‚Üí „Çµ„Ç§„ÉàË®≠ÂÆö ‚Üí „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Å®„É™„ÉÄ„Ç§„É¨„ÇØ„Éà ‚Üí Ë®±ÂèØ');
                log('3. Chrome: Âè≥‰∏ä‚ãÆ„É°„Éã„É•„Éº ‚Üí Ë®≠ÂÆö ‚Üí Ë©≥Á¥∞Ë®≠ÂÆö ‚Üí „Çµ„Ç§„ÉàË®≠ÂÆö ‚Üí „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Å®„É™„ÉÄ„Ç§„É¨„ÇØ„Éà');
                log('4. Safari: Ë®≠ÂÆö„Ç¢„Éó„É™ ‚Üí Safari ‚Üí „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Éñ„É≠„ÉÉ„ÇØ ‚Üí „Ç™„Éï');
                log('5. Ë®≠ÂÆöÂæå„ÄÅ„Åì„ÅÆ„Éö„Éº„Ç∏„ÇíÊõ¥Êñ∞„Åó„Å¶„ÇÇ„ÅÜ‰∏ÄÂ∫¶„É≠„Ç∞„Ç§„É≥„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            } else {
                log('üíª PCÂêë„ÅëËß£Ê±∫ÊâãÈ†Ü:');
                log('1. „Ç¢„Éâ„É¨„Çπ„Éê„ÉºÂè≥Á´Ø„ÅÆ„Ç¢„Ç§„Ç≥„É≥(üö´)„Çí„ÇØ„É™„ÉÉ„ÇØ ‚Üí Ë®±ÂèØ');
                log('2. „Åæ„Åü„ÅØ„ÄÅ„Éñ„É©„Ç¶„Ç∂Ë®≠ÂÆö ‚Üí „Éó„É©„Ç§„Éê„Ç∑„Éº„Å®„Çª„Ç≠„É•„É™„ÉÜ„Ç£ ‚Üí „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Å®„É™„ÉÄ„Ç§„É¨„ÇØ„Éà ‚Üí Ë®±ÂèØ');
            }
            log('üí° „Åù„Çå„Åß„ÇÇËß£Ê±∫„Åó„Å™„ÅÑÂ†¥Âêà: „Éó„É©„Ç§„Éô„Éº„Éà„É¢„Éº„Éâ„ÇíÁµÇ‰∫Ü„Åô„Çã„Åã„ÄÅÂà•„ÅÆ„Éñ„É©„Ç¶„Ç∂„Çí„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ');
            log('üîÑ „Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóË®≠ÂÆö„ÇíÁ¢∫Ë™ç„Åó„Åü„Çâ„ÄÅÂÜçÂ∫¶„ÄåGoogle„Åß„É≠„Ç∞„Ç§„É≥„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            log('üìñ ========================');
        }

        // „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÉÜ„Çπ„ÉàÊ©üËÉΩ
        window.testPopup = () => {
            log('üß™ „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÉÜ„Çπ„ÉàÈñãÂßã...');
            
            try {
                const testWindow = window.open('', '_blank', 'width=400,height=500');
                
                if (testWindow) {
                    log('‚úÖ „Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóË®±ÂèØÊ∏à„Åø - „É≠„Ç∞„Ç§„É≥ÂèØËÉΩ„Åß„Åô');
                    testWindow.close();
                    log('üí° „ÄåGoogle„Åß„É≠„Ç∞„Ç§„É≥„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                } else {
                    log('‚ùå „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Åå„Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô');
                    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                    showPopupGuide(isMobile);
                }
            } catch (error) {
                log(`‚ùå „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÉÜ„Çπ„Éà„Ç®„É©„Éº: ${error.message}`);
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                showPopupGuide(isMobile);
            }
        };

        // „É≠„Ç∞„Ç¢„Ç¶„Éà
        window.handleLogout = async () => {
            try {
                await auth.signOut();
                log('üì§ „É≠„Ç∞„Ç¢„Ç¶„ÉàÂÆå‰∫Ü');
            } catch (error) {
                log(`‚ùå „É≠„Ç∞„Ç¢„Ç¶„Éà„Ç®„É©„Éº: ${error.message}`);
            }
        };

        // „É≠„Éº„Ç´„É´TodoË™≠„ÅøËæº„Åø
        function loadLocalTodos() {
            const savedTodos = localStorage.getItem('todos');
            if (savedTodos) {
                todos = JSON.parse(savedTodos);
                renderTodos();
                log(`üìù „É≠„Éº„Ç´„É´TodoË™≠„ÅøËæº„Åø: ${todos.length}‰ª∂`);
            }
        }

        // „É≠„Éº„Ç´„É´„Ç´„ÉÜ„Ç¥„É™Ë™≠„ÅøËæº„Åø
        function loadLocalCategories() {
            const savedCategories = localStorage.getItem('categories');
            if (savedCategories) {
                categories = JSON.parse(savedCategories);
                renderCategories();
                updateCategoryDropdown();
                log(`üè∑Ô∏è „É≠„Éº„Ç´„É´„Ç´„ÉÜ„Ç¥„É™Ë™≠„ÅøËæº„Åø: ${categories.length}‰ª∂`);
            } else {
                renderCategories();
                updateCategoryDropdown();
            }
        }

        // Firebase TodoË™≠„ÅøËæº„Åø
        function loadUserTodos(userId) {
            const userRef = database.ref(`users/${userId}/todos`);
            userRef.on('value', (snapshot) => {
                const data = snapshot.val();
                
                if (data) {
                    todos = Object.values(data);
                    renderTodos();
                    log(`üìù Todo„Éá„Éº„ÇøË™≠„ÅøËæº„Åø: ${todos.length}‰ª∂`);
                } else {
                    todos = [];
                    renderTodos();
                    log('üìù Todo„Éá„Éº„Çø: „Å™„Åó');
                }
            });
        }

        // Firebase „Ç´„ÉÜ„Ç¥„É™Ë™≠„ÅøËæº„Åø
        function loadUserCategories(userId) {
            const categoryRef = database.ref(`users/${userId}/categories`);
            categoryRef.on('value', (snapshot) => {
                const data = snapshot.val();
                
                if (data) {
                    categories = Object.values(data);
                    renderCategories();
                    updateCategoryDropdown();
                    log(`üè∑Ô∏è „Ç´„ÉÜ„Ç¥„É™„Éá„Éº„ÇøË™≠„ÅøËæº„Åø: ${categories.length}‰ª∂`);
                } else {
                    categories = [];
                    renderCategories();
                    updateCategoryDropdown();
                    log('üè∑Ô∏è „Ç´„ÉÜ„Ç¥„É™„Éá„Éº„Çø: „Å™„Åó');
                }
            });
        }

        // UIË°®Á§∫Âà∂Âæ°
        function showUserInterface(user) {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('userPanel').classList.remove('hidden');
            document.getElementById('userName').textContent = user.displayName;
        }

        // ===============================================
        // üìù TodoÊ©üËÉΩ„ÅÆÂÆå‰∫Ü
        // ===============================================

        function showLoginInterface() {
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('userPanel').classList.add('hidden');
        }

        // „É≠„Ç∞Âá∫ÂäõÈñ¢Êï∞
        function log(message) {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            logArea.innerHTML += `[${timestamp}] ${message}<br>`;
            logArea.scrollTop = logArea.scrollHeight;
            console.log(message);
        }

        // „É≠„Ç∞„Ç≥„Éî„ÉºÊ©üËÉΩ
        window.copyLogs = () => {
            const logArea = document.getElementById('logArea');
            const logText = logArea.innerText || logArea.textContent;
            navigator.clipboard.writeText(logText).then(() => {
                alert('‚úÖ „É≠„Ç∞„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü');
            }).catch(() => {
                // fallback
                const textArea = document.createElement('textarea');
                textArea.value = logText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('‚úÖ „É≠„Ç∞„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü');
            });
        };

        // FirebaseÊé•Á∂ö„Éá„Éê„ÉÉ„Ç∞
        window.debugFirebaseConnection = () => {
            log('üîç === Firebase Debug ÈñãÂßã ===');
            
            // 1. FirebaseË®≠ÂÆöÁ¢∫Ë™ç
            log(`üî• Firebase ConfigÁ¢∫Ë™ç:`);
            log(`- Project ID: ${firebaseConfig.projectId}`);
            log(`- Database URL: ${firebaseConfig.databaseURL}`);
            log(`- Auth Domain: ${firebaseConfig.authDomain}`);
            
            // 2. Ë™çË®ºÁä∂ÊÖãÁ¢∫Ë™ç
            if (currentUser) {
                log(`‚úÖ Ë™çË®ºÊ∏à„Åø„É¶„Éº„Ç∂„Éº:`);
                log(`- UID: ${currentUser.uid.substring(0,8)}...`);
                log(`- Email: ${currentUser.email}`);
                log(`- Ë°®Á§∫Âêç: ${currentUser.displayName}`);
            } else {
                log('‚ùå Êú™Ë™çË®ºÁä∂ÊÖã');
            }
            
            // 3. Êé•Á∂ö„ÉÜ„Çπ„Éà
            const connectedRef = database.ref('.info/connected');
            connectedRef.once('value', (snapshot) => {
                const connected = snapshot.val();
                log(`üåê FirebaseÊé•Á∂öÁä∂ÊÖã: ${connected ? 'Êé•Á∂ö‰∏≠' : 'Êú™Êé•Á∂ö'}`);
                
                if (connected && currentUser) {
                    // „Éá„Éº„Çø„Éô„Éº„Çπ„ÉÜ„Çπ„Éà
                    const testRef = database.ref(`users/${currentUser.uid}/test`);
                    testRef.set({
                        timestamp: firebase.database.ServerValue.TIMESTAMP,
                        message: 'Connection test',
                        app: 'app-template'
                    }).then(() => {
                        log('‚úÖ „Éá„Éº„Çø„Éô„Éº„ÇπÊõ∏„ÅçËæº„Åø„ÉÜ„Çπ„ÉàÊàêÂäü');
                    }).catch((error) => {
                        log(`‚ùå „Éá„Éº„Çø„Éô„Éº„ÇπÊõ∏„ÅçËæº„Åø„Ç®„É©„Éº: ${error.message}`);
                        log(`- Error Code: ${error.code}`);
                    });
                }
            });
            
            log('üîç === Firebase Debug ÂÆå‰∫Ü ===');
        };

        // „É¢„Éê„Ç§„É´Áí∞Â¢ÉË®∫Êñ≠
        window.checkMobileSupport = () => {
            log('üì± === „É¢„Éê„Ç§„É´Áí∞Â¢ÉË®∫Êñ≠ ÈñãÂßã ===');
            
            const userAgent = navigator.userAgent;
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            
            log(`üåê „É¶„Éº„Ç∂„Éº„Ç®„Éº„Ç∏„Çß„É≥„Éà: ${userAgent}`);
            log(`üì± „É¢„Éê„Ç§„É´„Éá„Éê„Ç§„ÇπÂà§ÂÆö: ${isMobile ? '„É¢„Éê„Ç§„É´' : '„Éá„Çπ„ÇØ„Éà„ÉÉ„Éó'}`);
            
            // „Éñ„É©„Ç¶„Ç∂Âà§ÂÆö
            const isChrome = /Chrome/i.test(userAgent);
            const isSafari = /Safari/i.test(userAgent) && !/Chrome/i.test(userAgent);
            const isFirefox = /Firefox/i.test(userAgent);
            
            log(`üåê „Éñ„É©„Ç¶„Ç∂: ${isChrome ? 'Chrome' : isSafari ? 'Safari' : isFirefox ? 'Firefox' : '‰∏çÊòé'}`);
            
            // „É≠„Ç∞„Ç§„É≥ÊñπÂºè„ÅÆÊé®Â•®
            if (isMobile) {
                log('üí° „É¢„Éê„Ç§„É´„ÅÆÊé®Â•®Ë®≠ÂÆö:');
                log('- Google„É≠„Ç∞„Ç§„É≥„ÅØ„É™„ÉÄ„Ç§„É¨„ÇØ„ÉàÊñπÂºè„Çí‰ΩøÁî®');
                log('- „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Éñ„É≠„ÉÉ„Ç´„Éº„ÅÆÂΩ±Èüø„Å™„Åó');
                log('- Ë™çË®ºÂæå„Å´„Éö„Éº„Ç∏„ÅåÂÜçË™≠„ÅøËæº„Åø„Åï„Çå„Åæ„Åô');
            }
            
            log('üì± === „É¢„Éê„Ç§„É´Áí∞Â¢ÉË®∫Êñ≠ ÂÆå‰∫Ü ===');
        };

        // FirebaseË®≠ÂÆöË®∫Êñ≠
        window.checkFirebaseConfig = () => {
            log('üîß === FirebaseË®≠ÂÆöË®∫Êñ≠ ÈñãÂßã ===');
            
            // ÁèæÂú®„ÅÆ„Éâ„É°„Ç§„É≥Á¢∫Ë™ç
            const currentDomain = window.location.hostname;
            const currentUrl = window.location.href;
            log(`üåê ÁèæÂú®„ÅÆ„Éâ„É°„Ç§„É≥: ${currentDomain}`);
            log(`üîó ÁèæÂú®„ÅÆURL: ${currentUrl}`);
            
            // FirebaseË®≠ÂÆöÊÉÖÂ†±
            log(`üî• FirebaseË®≠ÂÆö:`);
            log(`- Project ID: ${firebaseConfig.projectId}`);
            log(`- Auth Domain: ${firebaseConfig.authDomain}`);
            log(`- Database URL: ${firebaseConfig.databaseURL}`);
            
            // Ë™çË®º„Éâ„É°„Ç§„É≥Ë®±ÂèØÁä∂Ê≥Å„ÅÆÊé®Ê∏¨
            if (currentDomain === 'muumuu8181.github.io') {
                log('‚úÖ GitHub Pages„Éâ„É°„Ç§„É≥Ê§úÂá∫');
                log('üí° Firebase Console„Åß„Åì„ÅÆ„Éâ„É°„Ç§„É≥„ÅåË®±ÂèØ„Åï„Çå„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç„ÅåÂøÖË¶Å');
            } else if (currentDomain === 'localhost' || currentDomain === '127.0.0.1') {
                log('‚úÖ „É≠„Éº„Ç´„É´„Éõ„Çπ„ÉàÊ§úÂá∫');
                log('üí° ÈÄöÂ∏∏„ÅØËá™Âãï„ÅßË®±ÂèØ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô');
            } else {
                log('‚ö†Ô∏è ‰∏çÊòé„Å™„Éâ„É°„Ç§„É≥„Åß„Åô');
                log('üí° Firebase Console„ÅÆË™çË®ºË®≠ÂÆö„ÅßË®±ÂèØ„ÅåÂøÖË¶Å„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„Çì');
            }
            
            // „É¢„Éê„Ç§„É´„Éñ„É©„Ç¶„Ç∂„Åß„ÅÆ„É™„ÉÄ„Ç§„É¨„ÇØ„ÉàÂà∂ÈôêÁ¢∫Ë™ç
            const userAgent = navigator.userAgent;
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            
            if (isMobile) {
                log('üì± „É¢„Éê„Ç§„É´„Éñ„É©„Ç¶„Ç∂Âõ∫Êúâ„ÅÆÂà∂Èôê:');
                log('- Safari: „Çµ„Éº„Éâ„Éë„Éº„ÉÜ„Ç£Cookie„ÅÆÂà∂Èôê„ÅÇ„Çä');
                log('- Chrome Mobile: „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÅÆËá™Âãï„Éñ„É≠„ÉÉ„ÇØ');
                log('- Ëß£Ê±∫Á≠ñ: „É™„ÉÄ„Ç§„É¨„ÇØ„ÉàÊñπÂºè„Åæ„Åü„ÅØ„Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóË®±ÂèØË®≠ÂÆö');
            }
            
            log('üîß === FirebaseË®≠ÂÆöË®∫Êñ≠ ÂÆå‰∫Ü ===');
        };

        // Ë™çË®ºÁä∂ÊÖã„ÅÆÂº∑Âà∂Á¢∫Ë™ç
        window.forceAuthCheck = () => {
            log('üîç === Ë™çË®ºÁä∂ÊÖãÂº∑Âà∂Á¢∫Ë™ç ÈñãÂßã ===');
            
            const user = auth.currentUser;
            log(`üîê FirebaseË™çË®ºÁä∂ÊÖã: ${user ? `„É≠„Ç∞„Ç§„É≥Ê∏à„Åø (${user.displayName})` : 'Êú™„É≠„Ç∞„Ç§„É≥'}`);
            
            if (user) {
                log('‚úÖ „É¶„Éº„Ç∂„ÉºÁîªÈù¢„ÇíË°®Á§∫„Åó„Åæ„Åô');
                showUserInterface(user);
                loadUserWeightData(user.uid);
            } else {
                log('‚ùå „É≠„Ç∞„Ç§„É≥ÁîªÈù¢„ÇíË°®Á§∫„Åó„Åæ„Åô');
                showLoginInterface();
            }
            
            // Ë™çË®º„Éà„Éº„ÇØ„É≥„ÅÆÊúâÂäπÊÄßÁ¢∫Ë™ç
            if (user) {
                user.getIdToken(true).then(() => {
                    log('‚úÖ Ë™çË®º„Éà„Éº„ÇØ„É≥„ÅØÊúâÂäπ„Åß„Åô');
                }).catch((tokenError) => {
                    log(`‚ùå Ë™çË®º„Éà„Éº„ÇØ„É≥„Ç®„É©„Éº: ${tokenError.message}`);
                    log('üí° ÂÜç„É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„Çì');
                });
            }
            
            log('üîç === Ë™çË®ºÁä∂ÊÖãÂº∑Âà∂Á¢∫Ë™ç ÂÆå‰∫Ü ===');
        };

        // „É≠„Ç∞„Ç§„É≥ÂïèÈ°åË®∫Êñ≠
        window.checkLoginIssues = () => {
            log('‚ö†Ô∏è === „É≠„Ç∞„Ç§„É≥ÂïèÈ°åË®∫Êñ≠ ÈñãÂßã ===');
            
            // 1. „Éó„É≠„Éà„Ç≥„É´„ÉÅ„Çß„ÉÉ„ÇØ
            const protocol = window.location.protocol;
            log(`üåê ÁèæÂú®„ÅÆ„Éó„É≠„Éà„Ç≥„É´: ${protocol}`);
            
            if (protocol === 'file:') {
                log('‚ùå ÂïèÈ°åÁô∫Ë¶ã: file://„Éó„É≠„Éà„Ç≥„É´„Åß„ÅØGoogleË™çË®º„ÅåÂãï‰Ωú„Åó„Åæ„Åõ„Çì');
                log('‚úÖ Ëß£Ê±∫ÊñπÊ≥ï:');
                log('  1. HTTP„Çµ„Éº„Éê„ÉºÁµåÁî±„Åß„Ç¢„ÇØ„Çª„Çπ');
                log('  2. chrome://flags „Åß insecure origins „ÇíË®±ÂèØ');
                log('  3. „É≠„Éº„Ç´„É´„Çµ„Éº„Éê„ÉºËµ∑Âãï (python -m http.server 8000)');
            } else if (protocol === 'https:' || protocol === 'http:') {
                log('‚úÖ „Éó„É≠„Éà„Ç≥„É´: ÂïèÈ°å„Å™„Åó');
            }
            
            // 2. Web StorageÁ¢∫Ë™ç
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                log('‚úÖ Web Storage: Âà©Áî®ÂèØËÉΩ');
            } catch (e) {
                log('‚ùå Web Storage: ÁÑ°Âäπ');
                log('‚úÖ Ëß£Ê±∫ÊñπÊ≥ï: „Éñ„É©„Ç¶„Ç∂Ë®≠ÂÆö„ÅßCookie„ÇíÊúâÂäπ„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            }
            
            // 3. Firebase„É©„Ç§„Éñ„É©„É™Á¢∫Ë™ç
            if (typeof firebase !== 'undefined') {
                log('‚úÖ Firebase SDK: Ë™≠„ÅøËæº„ÅøÊ∏à„Åø');
                log(`- Firebase Version: ${firebase.SDK_VERSION || 'Unknown'}`);
            } else {
                log('‚ùå Firebase SDK: Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº');
            }
            
            // 4. „Éâ„É°„Ç§„É≥Á¢∫Ë™ç
            const domain = window.location.hostname;
            log(`üè† ÁèæÂú®„ÅÆ„Éâ„É°„Ç§„É≥: ${domain}`);
            
            if (domain === 'localhost' || domain === '127.0.0.1') {
                log('‚úÖ „É≠„Éº„Ç´„É´ÈñãÁô∫: FirebaseË®≠ÂÆö„ÅßË®±ÂèØ„ÅåÂøÖË¶Å');
            }
            
            log('‚ö†Ô∏è === „É≠„Ç∞„Ç§„É≥ÂïèÈ°åË®∫Êñ≠ ÂÆå‰∫Ü ===');
        };

        // „Éá„Éº„Çø„Éô„Éº„ÇπÊßãÈÄ†Á¢∫Ë™ç
        window.checkDatabaseStructure = async () => {
            if (!currentUser) {
                log('‚ùå „É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åß„Åô');
                return;
            }
            
            log('üèóÔ∏è === „Éá„Éº„Çø„Éô„Éº„ÇπÊßãÈÄ†Á¢∫Ë™ç ÈñãÂßã ===');
            
            try {
                // ÁèæÂú®„ÅÆ„É¶„Éº„Ç∂„Éº„ÅÆweights„Éá„Éº„ÇøÊßãÈÄ†„ÇíÁ¢∫Ë™ç
                const userRef = database.ref(`users/${currentUser.uid}/weights`);
                const snapshot = await userRef.once('value');
                const data = snapshot.val();
                
                if (data) {
                    const entries = Object.keys(data);
                    log(`üìä ÁèæÂú®„ÅÆ„É¶„Éº„Ç∂„Éº(${currentUser.email})„ÅÆ„Éá„Éº„Çø:`);
                    log(`- Ë®òÈå≤Êï∞: ${entries.length}‰ª∂`);
                    log(`- ÊúÄÊñ∞Ë®òÈå≤ID: ${entries[entries.length - 1]}`);
                    
                    // „Çµ„É≥„Éó„É´„Éá„Éº„ÇøÊßãÈÄ†„ÇíË°®Á§∫
                    const sampleEntry = data[entries[0]];
                    log(`- „Éá„Éº„ÇøÊßãÈÄ†: ${JSON.stringify(sampleEntry, null, 2)}`);
                } else {
                    log('üìä ÁèæÂú®„ÅÆ„É¶„Éº„Ç∂„Éº„Å´„ÅØ„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                }
                
                // „É´„Éº„Éà„É¨„Éô„É´„ÅÆÊßãÈÄ†Á¢∫Ë™çÔºàÁÆ°ÁêÜËÄÖÊ®©Èôê„ÅåÂøÖË¶ÅÔºâ
                try {
                    const rootRef = database.ref('users');
                    const rootSnapshot = await rootRef.once('value');
                    const allUsers = rootSnapshot.val();
                    
                    if (allUsers) {
                        const userCount = Object.keys(allUsers).length;
                        log(`üë• ÂÖ®‰ΩìÁµ±Ë®à:`);
                        log(`- ÁôªÈå≤„É¶„Éº„Ç∂„ÉºÊï∞: ${userCount}‰∫∫`);
                        
                        let totalWeights = 0;
                        Object.values(allUsers).forEach(user => {
                            if (user.weights) {
                                totalWeights += Object.keys(user.weights).length;
                            }
                        });
                        log(`- ÂÖ®‰Ωì„ÅÆË®òÈå≤Êï∞: ${totalWeights}‰ª∂`);
                    }
                } catch (error) {
                    log(`‚ö†Ô∏è ÂÖ®‰ΩìÁµ±Ë®à„ÅÆÂèñÂæó„Å´Âà∂Èôê„Åå„ÅÇ„Çä„Åæ„Åô: ${error.message}`);
                }
                
            } catch (error) {
                log(`‚ùå ÊßãÈÄ†Á¢∫Ë™ç„Ç®„É©„Éº: ${error.message}`);
            }
            
            log('üèóÔ∏è === „Éá„Éº„Çø„Éô„Éº„ÇπÊßãÈÄ†Á¢∫Ë™ç ÂÆå‰∫Ü ===');
        };

        // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„Çí„Ç≥„Éî„Éº
        window.copyDebugInfo = () => {
            const debugInfo = `„Ç¢„Éó„É™„ÉÜ„É≥„Éó„É¨„Éº„Éà v0.24 „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±
=================================
„Çø„Ç§„É†„Çπ„Çø„É≥„Éó: ${new Date().toLocaleString()}
URL: ${window.location.href}
„Éó„É≠„Éà„Ç≥„É´: ${window.location.protocol}
„Éâ„É°„Ç§„É≥: ${window.location.hostname}
„É¶„Éº„Ç∂„Éº„Ç®„Éº„Ç∏„Çß„É≥„Éà: ${navigator.userAgent}

FirebaseË®≠ÂÆö:
- „Éó„É≠„Ç∏„Çß„ÇØ„ÉàID: ${firebaseConfig.projectId}
- „Éá„Éº„Çø„Éô„Éº„ÇπURL: ${firebaseConfig.databaseURL}
- Ë™çË®º„Éâ„É°„Ç§„É≥: ${firebaseConfig.authDomain}

Ë™çË®ºÁä∂ÊÖã: ${currentUser ? '„É≠„Ç∞„Ç§„É≥Ê∏à„Åø' : 'Êú™„É≠„Ç∞„Ç§„É≥'}
${currentUser ? `- UID: ${currentUser.uid.substring(0,8)}...\n- Email: ${currentUser.email}\n- Ë°®Á§∫Âêç: ${currentUser.displayName}` : ''}

Firebase SDK: ${typeof firebase !== 'undefined' ? 'Ë™≠„ÅøËæº„ÅøÊ∏à„Åø' : 'Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº'}
Web Storage: ${(() => {
    try {
        localStorage.setItem('test', 'test');
        localStorage.removeItem('test');
        return 'Âà©Áî®ÂèØËÉΩ';
    } catch (e) {
        return 'ÁÑ°Âäπ';
    }
})()}

„É≠„Ç∞ÂÜÖÂÆπ:
${document.getElementById('logArea').innerText}`;

            navigator.clipboard.writeText(debugInfo).then(() => {
                alert('‚úÖ „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü');
            }).catch(() => {
                // fallback
                const textArea = document.createElement('textarea');
                textArea.value = debugInfo;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('‚úÖ „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü');
            });
        };

        // ÂàùÊúüÂåñ
        // „Éë„Éç„É´„É¢„Éº„ÉâÂàá„ÇäÊõø„Åà
        window.togglePanelMode = () => {
            document.body.classList.toggle('panel-mode');
            const btn = document.querySelector('.mode-toggle');
            if (document.body.classList.contains('panel-mode')) {
                btn.textContent = 'üìä „Éë„Éç„É´Ë°®Á§∫';
                log('üìä „Éë„Éç„É´Ë°®Á§∫„É¢„Éº„Éâ: ON');
            } else {
                btn.textContent = 'üìÑ ÈÄöÂ∏∏Ë°®Á§∫';
                log('üìÑ „Éë„Éç„É´Ë°®Á§∫„É¢„Éº„Éâ: OFF');
            }
        };
        
        // „Ç∞„É™„ÉÉ„Éâ„É¢„Éº„ÉâÂàá„ÇäÊõø„Åà
        window.toggleGridMode = () => {
            const hasGridMode = document.body.classList.contains('grid-mode');
            log(`ÁèæÂú®„ÅÆ„Ç∞„É™„ÉÉ„Éâ„É¢„Éº„Éâ: ${hasGridMode ? 'ON' : 'OFF'}`);
            
            document.body.classList.toggle('grid-mode');
            const btn = document.querySelector('.grid-toggle');
            
            if (document.body.classList.contains('grid-mode')) {
                btn.textContent = '‚ñ° „Ç∞„É™„ÉÉ„ÉâOFF';
                btn.style.background = '#dc3545';
                log('‚äû „Ç∞„É™„ÉÉ„ÉâË°®Á§∫„É¢„Éº„Éâ: ON „Å´Âàá„ÇäÊõø„Åà');
                createGridOverlay();
            } else {
                btn.textContent = '‚äû „Ç∞„É™„ÉÉ„ÉâË°®Á§∫';
                btn.style.background = '#28a745';
                log('‚ñ° „Ç∞„É™„ÉÉ„ÉâË°®Á§∫„É¢„Éº„Éâ: OFF „Å´Âàá„ÇäÊõø„Åà');
                removeGridOverlay();
            }
        };
        
        // „Ç∞„É™„ÉÉ„Éâ„Ç™„Éº„Éê„Éº„É¨„Ç§‰ΩúÊàêÔºà„Ç∑„É≥„Éó„É´ÁâàÔºâ
        function createGridOverlay() {
            // Êó¢Â≠ò„ÅÆ„Ç™„Éº„Éê„Éº„É¨„Ç§„ÇíÂâäÈô§
            removeGridOverlay();
            
            const overlay = document.createElement('div');
            overlay.className = 'grid-overlay';
            overlay.id = 'gridOverlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none !important;
                z-index: 10000000;
            `;
            
            // „Ç∞„É™„ÉÉ„ÉâË®≠ÂÆö
            const gridSize = 30; // „Éî„ÇØ„Çª„É´Âçò‰Ωç
            const maxCols = Math.ceil(window.innerWidth / gridSize);
            const maxRows = Math.min(100, Math.ceil(window.innerHeight / gridSize)); // ÊúÄÂ§ß100Ë°å
            
            // ExcelÈ¢®„ÅÆÂàó„É©„Éô„É´ÁîüÊàêÈñ¢Êï∞
            function getColumnLabel(index) {
                let label = '';
                let num = index;
                while (num >= 0) {
                    label = String.fromCharCode(65 + (num % 26)) + label;
                    num = Math.floor(num / 26) - 1;
                    if (num < 0) break;
                }
                return label;
            }
            
            // „Ç∞„É™„ÉÉ„ÉâÁ∑ö„ÇíËøΩÂä†
            for (let i = 0; i <= maxCols; i++) {
                // ÂûÇÁõ¥Á∑ö
                const vLine = document.createElement('div');
                vLine.style.cssText = `
                    position: absolute;
                    left: ${i * gridSize}px;
                    top: 0;
                    width: 1px;
                    height: 100%;
                    background: rgba(40,167,69,0.2);
                    pointer-events: none;
                    z-index: 999998;
                `;
                overlay.appendChild(vLine);
            }
            
            for (let i = 0; i <= maxRows; i++) {
                // Ê∞¥Âπ≥Á∑ö
                const hLine = document.createElement('div');
                hLine.style.cssText = `
                    position: absolute;
                    left: 0;
                    top: ${i * gridSize}px;
                    width: 100%;
                    height: 1px;
                    background: rgba(40,167,69,0.2);
                    pointer-events: none;
                    z-index: 999998;
                `;
                overlay.appendChild(hLine);
            }
            
            // „É©„Éô„É´„ÇíËøΩÂä†Ôºà„Åô„Åπ„Å¶„ÅÆ„Ç∞„É™„ÉÉ„Éâ„Å´Ë°®Á§∫Ôºâ
            for (let row = 0; row <= maxRows; row++) {
                for (let col = 0; col <= maxCols; col++) {
                    if (row === 0 || col === 0) {
                        const label = document.createElement('div');
                        label.className = 'grid-number';
                        label.style.cssText = `
                            position: absolute;
                            font-size: 10px;
                            color: rgba(40,167,69,0.9);
                            font-weight: bold;
                            background: rgba(255,255,255,0.95);
                            padding: 1px 3px;
                            border-radius: 2px;
                            pointer-events: none;
                            z-index: 999999;
                        `;
                        
                        if (row === 0 && col > 0) {
                            // ‰∏äÈÉ®„Å´Âàó„É©„Éô„É´ÔºàA,B,C...Z,AA,AB...Ôºâ
                            label.textContent = getColumnLabel(col - 1);
                            label.style.left = `${col * gridSize - 10}px`;
                            label.style.top = '2px';
                            overlay.appendChild(label);
                        } else if (col === 0 && row > 0) {
                            // Â∑¶ÂÅ¥„Å´Ë°åÁï™Âè∑Ôºà1,2,3...100Ôºâ
                            label.textContent = row.toString();
                            label.style.left = '2px';
                            label.style.top = `${row * gridSize - 10}px`;
                            overlay.appendChild(label);
                        }
                    }
                }
            }
            
            document.body.appendChild(overlay);
        }
        
        function removeGridOverlay() {
            const overlay = document.getElementById('gridOverlay');
            if (overlay) overlay.remove();
        }
        
        // „Ç∞„É™„ÉÉ„Éâ‰ΩçÁΩÆË™øÊï¥„Éò„É´„Éë„ÉºÈñ¢Êï∞
        window.adjustGridPosition = (selector, gridCode, adjustment) => {
            // gridCode‰æã: "B4-C" (ÂàóB, Ë°å4-CÁØÑÂõ≤)
            // adjustment‰æã: 0.5 (0.5„Ç∞„É™„ÉÉ„ÉâÂàÜÁü≠„Åè/Â∞è„Åï„Åè)
            const element = document.querySelector(selector);
            if (!element) {
                log(`‚ùå Ë¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì: ${selector}`);
                return;
            }
            
            // „Ç∞„É™„ÉÉ„Éâ„Ç≥„Éº„Éâ„ÅÆËß£Êûê (‰æã: "B4" ‚Üí ÂàóB(2), Ë°å4)
            const match = gridCode.match(/^([A-T])(\d+)(?:-([A-T])?(\d+)?)?$/);
            if (!match) {
                log(`‚ùå ÁÑ°Âäπ„Å™„Ç∞„É™„ÉÉ„Éâ„Ç≥„Éº„Éâ: ${gridCode}`);
                return;
            }
            
            const startCol = match[1].charCodeAt(0) - 'A'.charCodeAt(0) + 1;
            const startRow = parseInt(match[2]);
            const endCol = match[3] ? match[3].charCodeAt(0) - 'A'.charCodeAt(0) + 1 : startCol;
            const endRow = match[4] ? parseInt(match[4]) : startRow;
            
            // „Ç∞„É™„ÉÉ„ÉâÂçò‰Ωç„Çí„Éî„ÇØ„Çª„É´„Å´Â§âÊèõÔºà30px„Åå1„Ç∞„É™„ÉÉ„ÉâÔºâ
            const gridWidth = 30;
            const gridHeight = 30;
            
            // ÁèæÂú®„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÂèñÂæó
            const currentStyle = window.getComputedStyle(element);
            const currentWidth = parseFloat(currentStyle.width);
            const currentHeight = parseFloat(currentStyle.height);
            
            // Ë™øÊï¥„ÇíÈÅ©Áî®
            if (adjustment < 0) {
                // „Éû„Ç§„Éä„ÇπË™øÊï¥ = Áü≠„Åè/Â∞è„Åï„Åè
                element.style.width = `${currentWidth + (adjustment * gridWidth)}px`;
                element.style.height = `${currentHeight + (adjustment * gridHeight)}px`;
            } else {
                // „Éó„É©„ÇπË™øÊï¥ = Èï∑„Åè/Â§ß„Åç„Åè
                element.style.width = `${currentWidth + (adjustment * gridWidth)}px`;
                element.style.height = `${currentHeight + (adjustment * gridHeight)}px`;
            }
            
            log(`‚úÖ „Ç∞„É™„ÉÉ„ÉâË™øÊï¥ÂÆå‰∫Ü: ${selector} @ ${gridCode} (${adjustment > 0 ? '+' : ''}${adjustment}„Ç∞„É™„ÉÉ„Éâ)`);
        };
        
        // „Ç∞„É™„ÉÉ„Éâ‰ΩçÁΩÆÂèñÂæó„Éò„É´„Éë„ÉºÈñ¢Êï∞
        window.getGridPosition = (selector) => {
            const element = document.querySelector(selector);
            if (!element) {
                log(`‚ùå Ë¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì: ${selector}`);
                return null;
            }
            
            const rect = element.getBoundingClientRect();
            const gridCol = Math.floor(rect.left / 30);
            const gridRow = Math.floor(rect.top / 30);
            
            const colLetter = String.fromCharCode('A'.charCodeAt(0) + gridCol);
            const position = `${colLetter}${gridRow + 1}`;
            
            log(`üìç „Ç∞„É™„ÉÉ„Éâ‰ΩçÁΩÆ: ${selector} ‚Üí ${position}`);
            return position;
        };
        
        // „Ç∞„É™„ÉÉ„ÉâË™øÊï¥„ÉÜ„Çπ„ÉàÈñ¢Êï∞
        window.testGridAdjust = () => {
            log('üìê === „Ç∞„É™„ÉÉ„ÉâË™øÊï¥„ÉÜ„Çπ„ÉàÈñãÂßã ===');
            
            // „Éë„Éç„É´„É¨„Éô„É´„ÅÆË¶ÅÁ¥†„ÇíË¶ã„Å§„Åë„Å¶Ë™øÊï¥
            const testElement = document.querySelector('[data-grid="B3"]');
            if (testElement) {
                log('üéØ B3„Éë„Éç„É´Ë¶ÅÁ¥†„ÇíÁô∫Ë¶ã');
                
                // ÂÖÉ„ÅÆ„Çµ„Ç§„Ç∫„ÇíË®òÈå≤
                const originalWidth = testElement.offsetWidth;
                const originalHeight = testElement.offsetHeight;
                log(`üìè ÂÖÉ„ÅÆ„Çµ„Ç§„Ç∫: ${originalWidth}x${originalHeight}px`);
                
                // 0.5„Ç∞„É™„ÉÉ„ÉâÂàÜË™øÊï¥
                adjustGridPosition('[data-grid="B3"]', 'B3', -0.5);
                
                // Êñ∞„Åó„ÅÑ„Çµ„Ç§„Ç∫„ÇíÁ¢∫Ë™ç
                const newWidth = testElement.offsetWidth;
                const newHeight = testElement.offsetHeight;
                log(`üìè Êñ∞„Åó„ÅÑ„Çµ„Ç§„Ç∫: ${newWidth}x${newHeight}px`);
                log(`üìä Â§âÂåñÈáè: ÂπÖ${newWidth - originalWidth}px, È´ò„Åï${newHeight - originalHeight}px`);
                
                // 3ÁßíÂæå„Å´ÂÖÉ„Å´Êàª„Åô
                setTimeout(() => {
                    adjustGridPosition('[data-grid="B3"]', 'B3', 0.5);
                    log('üîÑ ÂÖÉ„ÅÆ„Çµ„Ç§„Ç∫„Å´Âæ©ÂÖÉ„Åó„Åæ„Åó„Åü');
                }, 3000);
                
                log('‚è±Ô∏è 3ÁßíÂæå„Å´Ëá™ÂãïÁöÑ„Å´ÂÖÉ„ÅÆ„Çµ„Ç§„Ç∫„Å´Êàª„Çä„Åæ„Åô');
            } else {
                log('‚ùå B3„Éë„Éç„É´Ë¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                log('üí° „Ç∞„É™„ÉÉ„ÉâË°®Á§∫„ÇíON„Å´„Åó„Å¶„ÄÅË¶ÅÁ¥†„ÅÆ‰ΩçÁΩÆ„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            }
            
            log('üìê === „ÉÜ„Çπ„ÉàÁµÇ‰∫Ü ===');
        };
        
        log('üöÄ Simple Todo App v1.0 Ëµ∑ÂãïÂÆå‰∫Ü');
        log('üîê Ë™çË®º„Ç∑„Çπ„ÉÜ„É†Ê∫ñÂÇôÂÆå‰∫Ü');
        
        // „Éó„É≠„Éà„Ç≥„É´„ÉÅ„Çß„ÉÉ„ÇØÔºàËá™ÂãïË®∫Êñ≠Ôºâ
        if (window.location.protocol === 'file:') {
            log('‚ö†Ô∏è file://„Éó„É≠„Éà„Ç≥„É´Ê§úÂá∫ - Google„É≠„Ç∞„Ç§„É≥„Å´„ÅØ HTTP„Çµ„Éº„Éê„Éº„ÅåÂøÖË¶Å„Åß„Åô');
            log('üí° Ëß£Ê±∫ÊñπÊ≥ï: python -m http.server 8000 „Åæ„Åü„ÅØ chrome://flagsË®≠ÂÆö');
        }
    </script>
</body>
</html>
